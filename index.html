<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shared Link Hub</title>
  <link rel="icon" type="image/png" href="icons8-link-office-m-32.png">
  <link rel="shortcut icon" href="icons8-link-office-m-32.png" type="image/png">
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#06b6d4;--glass: rgba(255,255,255,0.02)}
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{margin:0;background:linear-gradient(180deg,#071126 0%,#071320 100%);color:#e6eef6;padding:18px}
    .container{max-width:900px;margin:18px auto}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px}
    .sub{color:var(--muted);font-size:13px}
    .card{background:var(--card);padding:14px;border-radius:12px;margin-top:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    .row{display:flex;gap:8px}
    input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
    button{padding:10px 12px;border-radius:8px;border:0;background:linear-gradient(90deg,var(--accent),#0ea5a1);color:#042;cursor:pointer}
    .links{margin-top:12px;display:grid;gap:8px}
    .link{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
    .meta{display:flex;gap:10px;align-items:center}
    .title{font-weight:600}
    .url{font-size:12px;color:var(--muted)}
    .small{font-size:12px;color:var(--muted)}
    .searchbar{display:flex;gap:8px;margin-top:10px}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px;border-radius:8px;cursor:pointer}
    .count{font-size:13px;color:var(--muted)}
    .icon{width:18px;height:18px;display:inline-block}
    .right{display:flex;gap:8px;align-items:center}
    .empty{color:var(--muted);padding:20px;text-align:center}
    .note{font-size:12px;color:var(--muted);margin-top:8px}
/* FIX: allow long URLs to wrap instead of stretching horizontally */
   .url, .title {
        word-break: break-word;
        overflow-wrap: break-word;
        white-space: normal;
        max-width: 100%;
} 
  </style>
</head>
<body>
  <div class="container">
    <header>
      <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M3 12h18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 6h18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" opacity=".6"/><path d="M3 18h18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" opacity=".6"/></svg>
      <div>
        <h1>Shared Link Hub</h1>
        <div class="sub">Publicly accessible â€” live updates for everyone</div>
      </div>
      <div style="flex:1"></div>
      <div class="right">
        <div class="count" id="count">0 links</div>
        <button class="btn-ghost" id="copyBtn" title="Copy page URL to share">Share</button>
      </div>
    </header>

    <div class="card">
      <div style="display:flex;gap:8px;align-items:center">
        <input id="search" type="text" placeholder="Search links (title or URL)" />
        <button id="clearSearch" class="btn-ghost">Clear</button>
      </div>

      <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
        <input id="title" type="text" placeholder="Link title (e.g., My favorite blog)" />
        <input id="url" type="text" placeholder="https://example.com" style="min-width:260px" />
        <button id="add">Add / Update</button>
      </div>

      <div class="links" id="links"></div>
      <div class="note">Changes are visible to everyone who opens this page. <strong>All edits are public.</strong></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB8coyzmAa-9w5GJ4Qj0syE0hq-uXSbfv0",
      authDomain: "realtimedatabase-2790a.firebaseapp.com",
      databaseURL: "https://realtimedatabase-2790a-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "realtimedatabase-2790a",
      storageBucket: "realtimedatabase-2790a.firebasestorage.app",
      messagingSenderId: "446913418450",
      appId: "1:446913418450:web:68c6975727859da74f090b",
      measurementId: "G-TNQD27DEZP"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const linksRef = db.ref('links');

    const titleEl = document.getElementById('title');
    const urlEl = document.getElementById('url');
    const addBtn = document.getElementById('add');
    const linksEl = document.getElementById('links');
    const countEl = document.getElementById('count');
    const searchEl = document.getElementById('search');
    const clearSearchBtn = document.getElementById('clearSearch');
    const copyBtn = document.getElementById('copyBtn');

    function sanitizeUrl(u){
      try {
        const s = u.trim();
        if(!s) return '';
        return s.match(/^https?:\/\//i) ? s : 'https://' + s;
      } catch(e){ return u; }
    }

    // ðŸ”¥ FIX: Safe SHA-256 key generator
    async function hashKey(str) {
      const msg = new TextEncoder().encode(str);
      const buf = await crypto.subtle.digest("SHA-256", msg);
      return Array.from(new Uint8Array(buf)).map(x => x.toString(16).padStart(2,"0")).join('');
    }

    addBtn.addEventListener('click', async () => {
      const title = titleEl.value.trim();
      const rawUrl = urlEl.value.trim();

      if (!title || !rawUrl) {
        alert('Please enter both title and URL');
        return;
      }

      const url = sanitizeUrl(rawUrl);
      const key = await hashKey(url);   // FIXED â€” no more undefined

      const payload = { title, url, updatedAt: Date.now() };

      linksRef.child(key).set(payload).then(() => {
        titleEl.value = '';
        urlEl.value = '';
      }).catch(err => alert('Failed to save: ' + err.message));
    });

    function removeLink(key) {
      if (!confirm('Remove this link?')) return;
      linksRef.child(key).remove();
    }

    function renderItem(key, data){
      const div = document.createElement('div');
      div.className = 'link';
      div.id = 'link-' + key;

      const left = document.createElement('div');
      left.className = 'meta';
      left.innerHTML = `
        <div class="title">${escapeHtml(data.title)}</div>
        <div class="url">${escapeHtml(data.url)}</div>
      `;

      const right = document.createElement('div');
      right.className = 'right';

      const openBtn = document.createElement('button');
      openBtn.className = 'btn-ghost';
      openBtn.innerText = 'Open';
      openBtn.onclick = () => window.open(data.url, '_blank');

      const editBtn = document.createElement('button');
      editBtn.className = 'btn-ghost';
      editBtn.innerText = 'Edit';
      editBtn.onclick = () => {
        titleEl.value = data.title;
        urlEl.value = data.url;
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      const delBtn = document.createElement('button');
      delBtn.className = 'btn-ghost';
      delBtn.innerText = 'Delete';
      delBtn.onclick = () => removeLink(key);

      right.appendChild(openBtn);
      right.appendChild(editBtn);
      right.appendChild(delBtn);

      div.appendChild(left);
      div.appendChild(right);
      return div;
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[m]));
    }

    const local = {};

    function updateView(){
      const q = searchEl.value.trim().toLowerCase();
      linksEl.innerHTML = '';

      const items = Object.entries(local)
        .filter(([k,v]) => {
          if (!v) return false;
          if (!q) return true;
          return v.title.toLowerCase().includes(q) ||
                 v.url.toLowerCase().includes(q);
        })
        .sort((a,b)=> (b[1].updatedAt||0) - (a[1].updatedAt||0));

      if (items.length === 0) {
        linksEl.innerHTML = '<div class="empty">No links yet. Add one above.</div>';
      } else {
        items.forEach(([k,v]) => linksEl.appendChild(renderItem(k,v)));
      }
      countEl.innerText = Object.keys(local).length + ' links';
    }

    linksRef.on('child_added', snap => { local[snap.key] = snap.val(); updateView(); });
    linksRef.on('child_changed', snap => { local[snap.key] = snap.val(); updateView(); });
    linksRef.on('child_removed', snap => { delete local[snap.key]; updateView(); });

    searchEl.addEventListener('input', updateView);
    clearSearchBtn.addEventListener('click', () => { searchEl.value = ''; updateView(); });

    copyBtn.addEventListener('click', () => {
      navigator.clipboard?.writeText(location.href).then(() => {
        copyBtn.innerText = 'Copied!';
        setTimeout(()=> copyBtn.innerText = 'Share', 1200);
      });
    });

    linksRef.once('value')
      .then(snap => { snap.forEach(child => local[child.key] = child.val()); updateView(); })
      .catch(err => {
        console.error('Firebase read error', err);
        linksEl.innerHTML = '<div class="empty">Unable to load links. Check Firebase configuration and DB rules.</div>';
      });
  </script>
</body>
</html>


